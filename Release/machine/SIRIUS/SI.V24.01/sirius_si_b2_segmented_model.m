function [model, model_length] = sirius_si_b2_segmented_model(passmethod, m_accep_fam_name)

b_famname = 'B2';
mb_famname = ['m',b_famname];
edge_famname = [b_famname, '_edge'];

if ~exist('passmethod','var'), passmethod = 'BndMPoleSymplectic4Pass'; end
if ~exist('m_accep_fam_name','var'), m_accep_fam_name = 'calc_mom_accep'; end

types = {};
b2      = 1; types{end+1} = struct('fam_name', b_famname, 'passmethod', passmethod);
b2_edge = 2; types{end+1} = struct('fam_name', edge_famname, 'passmethod', 'IdentityPass');
m_accep = 3; types{end+1} = struct('fam_name', m_accep_fam_name, 'passmethod', 'IdentityPass');


% FIELDMAP
% *** interpolation of fields is now cubic ***
% *** more refined segmented model.
% *** dipole angle is now in units of degrees
%--- model polynom_b (rz > 0). units: [m] for length, [rad] for angle and [m],[T] for polynom_b ---

% B2 model 08 (3 GeV)
% ===================
% filename: 2017-05-17_B2_Model08_Sim_X=-63_27mm_Z=-1000_1000mm_Imc=394.1A.txt
% trajectory centered in good-field region.
% init_rx is set to  7.92 mm at s=0

monomials = [0,1,2,3,4,5,6];
segmodel = [ ...
%type     len[m]    angle[deg]  PolyB(n=0)   PolyB(n=1)   PolyB(n=2)   PolyB(n=3)   PolyB(n=4)   PolyB(n=5)   PolyB(n=6)   
b2,        0.1250 ,  +0.40481 ,  +0.00e+00 ,  -7.74e-01 ,  +4.46e-02 ,  +1.66e+00 ,  +3.21e+01 ,  +3.14e+03 ,  +1.33e+05 ; 
b2,        0.0550 ,  +0.17931 ,  +0.00e+00 ,  -7.74e-01 ,  +2.77e-02 ,  +1.44e+00 ,  +2.26e+01 ,  +2.92e+03 ,  +1.21e+05 ; 
b2,        0.0100 ,  +0.03263 ,  +0.00e+00 ,  -7.74e-01 ,  +1.78e-02 ,  +1.27e+00 ,  -1.80e+01 ,  +4.06e+03 ,  +9.54e+04 ; 
b2,        0.0050 ,  +0.01626 ,  +0.00e+00 ,  -7.67e-01 ,  -1.88e-02 ,  +3.45e-01 ,  -3.28e+01 ,  +5.41e+03 ,  +7.86e+03 ; 
b2,        0.0050 ,  +0.01620 ,  +0.00e+00 ,  -7.59e-01 ,  -1.50e-01 ,  +3.96e-01 ,  -4.87e+01 ,  +6.49e+03 ,  +4.25e+04 ; 
b2,        0.0050 ,  +0.01617 ,  +0.00e+00 ,  -7.53e-01 ,  -2.68e-01 ,  +1.14e+00 ,  -3.73e+01 ,  +7.62e+03 ,  -7.89e+04 ; 
m_accep,  0,0,0,0,0,0,0,0,0;
b2,        0.0050 ,  +0.01619 ,  +0.00e+00 ,  -7.56e-01 ,  -1.95e-01 ,  +6.57e-01 ,  -4.55e+01 ,  +7.04e+03 ,  +2.61e+03 ; 
b2,        0.0100 ,  +0.03253 ,  +0.00e+00 ,  -7.68e-01 ,  -1.11e-02 ,  +6.49e-01 ,  -3.45e+01 ,  +5.44e+03 ,  +3.61e+04 ; 
b2,        0.0100 ,  +0.03265 ,  +0.00e+00 ,  -7.74e-01 ,  +2.23e-02 ,  +1.71e+00 ,  -1.24e+00 ,  +3.61e+03 ,  +1.07e+05 ; 
b2,        0.1750 ,  +0.56774 ,  +0.00e+00 ,  -7.73e-01 ,  +8.13e-02 ,  +2.99e+00 ,  +5.39e+01 ,  +2.92e+03 ,  +1.23e+05 ; 
b2,        0.1750 ,  +0.56735 ,  +0.00e+00 ,  -7.73e-01 ,  +1.07e-01 ,  +4.38e+00 ,  +8.27e+01 ,  +3.27e+03 ,  +1.22e+05 ; 
b2,        0.0200 ,  +0.06336 ,  +0.00e+00 ,  -7.91e-01 ,  -3.03e-02 ,  +8.98e+00 ,  +8.71e+01 ,  +7.12e+03 ,  +3.61e+04 ; 
b2,        0.0100 ,  +0.02751 ,  +0.00e+00 ,  -6.82e-01 ,  -2.04e-01 ,  +1.38e+01 ,  -1.03e+02 ,  +1.27e+04 ,  -2.77e+05 ; 
b2_edge, 0,0,0,0,0,0,0,0,0;
b2,        0.0150 ,  +0.02960 ,  +0.00e+00 ,  -3.61e-01 ,  -2.44e+00 ,  +1.92e+01 ,  -2.39e+02 ,  +1.75e+04 ,  -2.13e+05 ; 
b2,        0.0200 ,  +0.02204 ,  +0.00e+00 ,  -1.08e-01 ,  -2.48e+00 ,  +1.07e+01 ,  -1.61e+02 ,  +7.25e+03 ,  +2.19e+03 ; 
b2,        0.0300 ,  +0.01445 ,  +0.00e+00 ,  -2.59e-02 ,  -1.22e+00 ,  +4.05e+00 ,  -8.35e+00 ,  +6.42e+02 ,  +2.43e+04 ; 
b2,        0.0320 ,  +0.00530 ,  +0.00e+00 ,  -5.22e-03 ,  -3.59e-01 ,  +1.00e+00 ,  +1.67e+01 ,  -4.09e+01 ,  +3.58e+03 ; 
b2,        0.0325 ,  +0.00410 ,  +6.74e-06 ,  -1.02e-03 ,  -1.49e-01 ,  +2.51e-01 ,  +6.75e+00 ,  -1.79e+01 ,  +3.81e+01 ;
m_accep,  0,0,0,0,0,0,0,0,0;
];



% % FIELDMAP
% % *** interpolation of fields is now cubic ***
% % *** more refined segmented model.
% % *** dipole angle is now in units of degrees
% %--- model polynom_b (rz > 0). units: [m] for length, [rad] for angle and [m],[T] for polynom_b ---
% 
% % B2 model 02 (3 GeV)
% % ===================
% % filename: 2017-05-06_B2_Complete_Model_X=-63_27mm_Z=-1000_1000mm_FAC.txt
% % trajectory centered in good-field region.
% % init_rx is set to  7.92 mm at s=0
% 
% monomials = [0,1,2,3,4,5,6];
% segmodel = [ ...
% %type     len[m]    angle[deg]  PolyB(n=0)   PolyB(n=1)   PolyB(n=2)   PolyB(n=3)   PolyB(n=4)   PolyB(n=5)   PolyB(n=6)   
% b2,       0.1250 ,  +0.40481 ,  +0.00e+00 ,  -7.74e-01 ,  +4.46e-02 ,  +1.66e+00 ,  +3.21e+01 ,  +3.14e+03 ,  +1.33e+05 ; 
% b2,       0.0550 ,  +0.17931 ,  +0.00e+00 ,  -7.74e-01 ,  +2.77e-02 ,  +1.44e+00 ,  +2.26e+01 ,  +2.92e+03 ,  +1.21e+05 ; 
% b2,       0.0100 ,  +0.03263 ,  +0.00e+00 ,  -7.74e-01 ,  +1.78e-02 ,  +1.27e+00 ,  -1.80e+01 ,  +4.06e+03 ,  +9.54e+04 ; 
% b2,       0.0050 ,  +0.01626 ,  +0.00e+00 ,  -7.67e-01 ,  -1.88e-02 ,  +3.45e-01 ,  -3.28e+01 ,  +5.41e+03 ,  +7.86e+03 ; 
% b2,       0.0050 ,  +0.01620 ,  +0.00e+00 ,  -7.59e-01 ,  -1.50e-01 ,  +3.96e-01 ,  -4.87e+01 ,  +6.49e+03 ,  +4.25e+04 ; 
% b2,       0.0050 ,  +0.01617 ,  +0.00e+00 ,  -7.53e-01 ,  -2.68e-01 ,  +1.14e+00 ,  -3.73e+01 ,  +7.62e+03 ,  -7.89e+04 ; 
% m_accep,  0,0,0,0,0,0,0,0,0;
% b2,       0.0050 ,  +0.01619 ,  +0.00e+00 ,  -7.56e-01 ,  -1.95e-01 ,  +6.57e-01 ,  -4.55e+01 ,  +7.04e+03 ,  +2.61e+03 ; 
% b2,       0.0100 ,  +0.03253 ,  +0.00e+00 ,  -7.68e-01 ,  -1.11e-02 ,  +6.49e-01 ,  -3.45e+01 ,  +5.44e+03 ,  +3.61e+04 ; 
% b2,       0.0100 ,  +0.03265 ,  +0.00e+00 ,  -7.74e-01 ,  +2.23e-02 ,  +1.71e+00 ,  -1.24e+00 ,  +3.61e+03 ,  +1.07e+05 ; 
% b2,       0.1750 ,  +0.56774 ,  +0.00e+00 ,  -7.73e-01 ,  +8.13e-02 ,  +2.99e+00 ,  +5.39e+01 ,  +2.92e+03 ,  +1.23e+05 ; 
% b2,       0.1750 ,  +0.56735 ,  +0.00e+00 ,  -7.73e-01 ,  +1.07e-01 ,  +4.38e+00 ,  +8.27e+01 ,  +3.27e+03 ,  +1.22e+05 ; 
% b2,       0.0200 ,  +0.06336 ,  +0.00e+00 ,  -7.91e-01 ,  -3.03e-02 ,  +8.98e+00 ,  +8.71e+01 ,  +7.12e+03 ,  +3.61e+04 ; 
% b2,       0.0100 ,  +0.02751 ,  +0.00e+00 ,  -6.82e-01 ,  -2.04e-01 ,  +1.38e+01 ,  -1.03e+02 ,  +1.27e+04 ,  -2.77e+05 ; 
% b2_edge, 0,0,0,0,0,0,0,0,0;
% b2,       0.0150 ,  +0.02960 ,  +0.00e+00 ,  -3.61e-01 ,  -2.44e+00 ,  +1.92e+01 ,  -2.39e+02 ,  +1.75e+04 ,  -2.13e+05 ; 
% b2,       0.0200 ,  +0.02204 ,  +0.00e+00 ,  -1.08e-01 ,  -2.48e+00 ,  +1.07e+01 ,  -1.61e+02 ,  +7.25e+03 ,  +2.19e+03 ; 
% b2,       0.0300 ,  +0.01445 ,  +0.00e+00 ,  -2.59e-02 ,  -1.22e+00 ,  +4.05e+00 ,  -8.35e+00 ,  +6.42e+02 ,  +2.43e+04 ; 
% b2,       0.0320 ,  +0.00530 ,  +0.00e+00 ,  -5.22e-03 ,  -3.59e-01 ,  +1.00e+00 ,  +1.67e+01 ,  -4.09e+01 ,  +3.58e+03 ; 
% b2,       0.0325 ,  +0.00410 ,  +6.74e-06 ,  -1.02e-03 ,  -1.49e-01 ,  +2.51e-01 ,  +6.75e+00 ,  -1.79e+01 ,  +3.81e+01 ; 
% m_accep,  0,0,0,0,0,0,0,0,0;
% ];


% % FIELDMAP
% % *** interpolation of fields is now cubic ***
% % *** more refined segmented model.
% % *** dipole angle is now in units of degrees
% %--- model polynom_b (rz > 0). units: [m] for length, [rad] for angle and [m],[T] for polynom_b ---
% 
% % B2 model 02 (3 GeV)
% % ===================
% % filename: 2017-04-24_B2_TempModel02_X=-63_27mm_Z=-1000_1000mm_Imc=394.1A.txt
% % trajectory centered in good-field region.
% % init_rx is set to  7.70 mm at s=0
% 
% monomials = [0,1,2,3,4,5,6];
% segmodel = [ ...
% %type     len[m]    angle[deg]  PolyB(n=0)   PolyB(n=1)   PolyB(n=2)   PolyB(n=3)   PolyB(n=4)   PolyB(n=5)   PolyB(n=6)   
% 
% b2,       0.1250 ,  +0.40594 ,  +0.00e+00 ,  -7.75e-01 ,  +4.97e-02 ,  +1.79e+00 ,  +2.24e+01 ,  +2.03e+03 ,  +1.36e+05 ; 
% b2,       0.0550 ,  +0.17982 ,  +0.00e+00 ,  -7.75e-01 ,  +3.25e-02 ,  +1.59e+00 ,  +1.65e+01 ,  +1.83e+03 ,  +1.16e+05 ; 
% b2,       0.0100 ,  +0.03273 ,  +0.00e+00 ,  -7.75e-01 ,  +1.97e-02 ,  +1.48e+00 ,  -2.60e+01 ,  +3.11e+03 ,  +8.21e+04 ; 
% b2,       0.0050 ,  +0.01631 ,  +0.00e+00 ,  -7.69e-01 ,  -1.11e-02 ,  +4.77e-01 ,  -5.22e+01 ,  +5.25e+03 ,  +1.41e+04 ; 
% b2,       0.0050 ,  +0.01626 ,  +0.00e+00 ,  -7.62e-01 ,  -1.30e-01 ,  +3.12e-01 ,  -5.61e+01 ,  +6.93e+03 ,  -4.95e+04 ; 
% b2,       0.0050 ,  +0.01623 ,  +0.00e+00 ,  -7.56e-01 ,  -2.38e-01 ,  +1.00e+00 ,  -7.17e+01 ,  +7.77e+03 ,  -1.28e+04 ; 
% m_accep,  0,0,0,0,0,0,0,0,0;
% b2,       0.0050 ,  +0.01625 ,  +0.00e+00 ,  -7.59e-01 ,  -1.71e-01 ,  +6.58e-01 ,  -6.93e+01 ,  +6.95e+03 ,  +2.68e+04 ; 
% b2,       0.0100 ,  +0.03264 ,  +0.00e+00 ,  -7.70e-01 ,  -5.23e-03 ,  +7.93e-01 ,  -4.51e+01 ,  +5.25e+03 ,  +1.93e+04 ; 
% b2,       0.0100 ,  +0.03275 ,  +0.00e+00 ,  -7.76e-01 ,  +2.42e-02 ,  +1.88e+00 ,  -6.02e+00 ,  +2.51e+03 ,  +9.58e+04 ; 
% b2,       0.1750 ,  +0.56938 ,  +0.00e+00 ,  -7.74e-01 ,  +8.74e-02 ,  +3.13e+00 ,  +4.63e+01 ,  +1.97e+03 ,  +1.19e+05 ; 
% b2,       0.1750 ,  +0.56908 ,  +0.00e+00 ,  -7.74e-01 ,  +1.12e-01 ,  +4.56e+00 ,  +7.75e+01 ,  +2.18e+03 ,  +1.11e+05 ; 
% b2,       0.0200 ,  +0.06349 ,  +0.00e+00 ,  -7.94e-01 ,  -8.89e-02 ,  +8.45e+00 ,  +1.28e+02 ,  +7.27e+03 ,  -1.10e+05 ; 
% b2,       0.0100 ,  +0.02739 ,  +0.00e+00 ,  -6.85e-01 ,  -3.28e-01 ,  +1.22e+01 ,  +1.37e+01 ,  +2.07e+04 ,  -4.24e+05 ; 
% b2_edge, 0,0,0,0,0,0,0,0,0;
% b2,       0.0150 ,  +0.02884 ,  +0.00e+00 ,  -3.62e-01 ,  -2.43e+00 ,  +1.83e+01 ,  -1.47e+02 ,  +2.22e+04 ,  -4.85e+05 ; 
% b2,       0.0200 ,  +0.02011 ,  +0.00e+00 ,  -1.07e-01 ,  -2.20e+00 ,  +1.10e+01 ,  -1.34e+02 ,  +7.46e+03 ,  -6.93e+04 ; 
% b2,       0.0300 ,  +0.01217 ,  +0.00e+00 ,  -2.40e-02 ,  -9.10e-01 ,  +3.87e+00 ,  -2.23e+00 ,  +5.70e+02 ,  +4.98e+03 ; 
% b2,       0.0320 ,  +0.00465 ,  +0.00e+00 ,  -4.54e-03 ,  -2.71e-01 ,  +8.42e-01 ,  +1.06e+01 ,  -3.36e+01 ,  +2.89e+03 ; 
% b2,       0.0325 ,  +0.00416 ,  -3.47e-05 ,  -8.49e-04 ,  -1.36e-01 ,  +2.24e-01 ,  +5.30e+00 ,  -1.39e+01 ,  -1.19e+02 ; 
% m_accep,  0,0,0,0,0,0,0,0,0;
% ];


% % FIELDMAP
% % *** interpolation of fields is now cubic ***
% % *** more refined segmented model.
% % *** dipole angle is now in units of degrees
% %--- model polynom_b (rz > 0). units: [m] for length, [rad] for angle and [m],[T] for polynom_b ---
% 
% % B2 model 01 (3 GeV)
% % ===================
% % filename: 2017-02-01_B2_Model07_Sim_X=-63_27mm_Z=-1000_1000mm_Imc=451.8A.txt
% % trajectory centered in good-field region.
% % init_rx is set to  7.71 mm at s=0
% 
% monomials = [0,1,2,3,4,5,6];
% segmodel = [ ...
% %type     len[m]    angle[deg]  PolyB(n=0)   PolyB(n=1)   PolyB(n=2)   PolyB(n=3)   PolyB(n=4)   PolyB(n=5)   PolyB(n=6)   
% b2,       0.1250 ,  +0.40594 ,  +0.00e+00 ,  -7.74e-01 ,  +2.86e-02 ,  +9.53e-01 ,  +2.54e+01 ,  +2.73e+03 ,  +1.43e+05 ; 
% b2,       0.0550 ,  +0.17982 ,  +0.00e+00 ,  -7.74e-01 ,  +1.27e-02 ,  +7.52e-01 ,  +1.74e+01 ,  +2.48e+03 ,  +1.23e+05 ; 
% b2,       0.0100 ,  +0.03273 ,  +0.00e+00 ,  -7.74e-01 ,  +6.21e-04 ,  +5.61e-01 ,  -2.39e+01 ,  +3.91e+03 ,  +7.76e+04 ; 
% b2,       0.0050 ,  +0.01631 ,  +0.00e+00 ,  -7.68e-01 ,  -2.98e-02 ,  -5.18e-01 ,  -5.34e+01 ,  +6.06e+03 ,  +3.11e+04 ; 
% b2,       0.0050 ,  +0.01626 ,  +0.00e+00 ,  -7.60e-01 ,  -1.48e-01 ,  -8.61e-01 ,  -7.32e+01 ,  +8.04e+03 ,  +9.50e+04 ; 
% b2,       0.0050 ,  +0.01623 ,  +0.00e+00 ,  -7.55e-01 ,  -2.56e-01 ,  -3.44e-01 ,  -6.29e+01 ,  +9.34e+03 ,  -1.10e+04 ; 
% m_accep,  0,0,0,0,0,0,0,0,0;
% b2,       0.0050 ,  +0.01625 ,  +0.00e+00 ,  -7.58e-01 ,  -1.89e-01 ,  -6.96e-01 ,  -6.17e+01 ,  +9.08e+03 ,  -5.79e+03 ; 
% b2,       0.0100 ,  +0.03264 ,  +0.00e+00 ,  -7.69e-01 ,  -2.40e-02 ,  -1.77e-01 ,  -4.14e+01 ,  +5.98e+03 ,  +1.01e+03 ; 
% b2,       0.0100 ,  +0.03275 ,  +0.00e+00 ,  -7.75e-01 ,  +5.04e-03 ,  +1.01e+00 ,  -6.86e+00 ,  +3.21e+03 ,  +1.08e+05 ; 
% b2,       0.1750 ,  +0.56938 ,  +0.00e+00 ,  -7.73e-01 ,  +6.66e-02 ,  +2.29e+00 ,  +4.88e+01 ,  +2.65e+03 ,  +1.23e+05 ; 
% b2,       0.1750 ,  +0.56908 ,  +0.00e+00 ,  -7.73e-01 ,  +9.13e-02 ,  +3.73e+00 ,  +8.02e+01 ,  +2.83e+03 ,  +1.18e+05 ; 
% b2,       0.0200 ,  +0.06349 ,  +0.00e+00 ,  -7.93e-01 ,  -1.03e-01 ,  +7.72e+00 ,  +9.15e+01 ,  +7.18e+03 ,  +4.04e+04 ; 
% b2,       0.0100 ,  +0.02739 ,  +0.00e+00 ,  -6.84e-01 ,  -3.18e-01 ,  +1.19e+01 ,  -9.12e+01 ,  +1.93e+04 ,  -3.21e+05 ; 
% b2_edge, 0,0,0,0,0,0,0,0,0;
% b2,       0.0150 ,  +0.02884 ,  +0.00e+00 ,  -3.62e-01 ,  -2.41e+00 ,  +1.80e+01 ,  -2.58e+02 ,  +2.13e+04 ,  -9.09e+04 ; 
% b2,       0.0200 ,  +0.02011 ,  +0.00e+00 ,  -1.07e-01 ,  -2.19e+00 ,  +1.09e+01 ,  -1.50e+02 ,  +7.33e+03 ,  +1.38e+04 ; 
% b2,       0.0300 ,  +0.01217 ,  +0.00e+00 ,  -2.40e-02 ,  -9.10e-01 ,  +3.87e+00 ,  -3.98e+00 ,  +4.84e+02 ,  +1.98e+04 ; 
% b2,       0.0320 ,  +0.00465 ,  +0.00e+00 ,  -4.54e-03 ,  -2.71e-01 ,  +8.42e-01 ,  +1.10e+01 ,  -3.52e+01 ,  +3.41e+02 ; 
% b2,       0.0325 ,  +0.00416 ,  +7.41e-05 ,  -8.50e-04 ,  -1.36e-01 ,  +2.24e-01 ,  +5.24e+00 ,  -1.76e+01 ,  +3.52e+02 ; 
% m_accep,  0,0,0,0,0,0,0,0,0;
% ];



% % FIELDMAP
% % *** interpolation of fields is now cubic ***
% % *** more refined segmented model.
% % *** dipole angle is now in units of degrees
% %--- model polynom_b (rz > 0). units: [m] for length, [rad] for angle and [m],[T] for polynom_b ---
% 
% % B2 model 2017-02-01 (3GeV)
% % ===========================
% % dipole model-07
% % filename: 2017-02-01_B2_Model07_Sim_X=-63_27mm_Z=-1000_1000mm_Imc=451.8A.txt
% % trajectory centered in good-field region.
% % init_rx is set to  5.444 mm at s=0
% 
% monomials = [0,1,2,3,4,5,6];
% segmodel = [ ...
% %type     len[m]   angle[deg]  PolyB(n=0)   PolyB(n=1)   PolyB(n=2)   PolyB(n=3)   PolyB(n=4)   PolyB(n=5)   PolyB(n=6)
% b2,       0.1250 ,  +0.40617 ,  +0.00e+00 ,  -7.76e-01 ,  +1.52e-01 ,  -1.02e-01 ,  +3.47e+02 ,  -5.76e+03 ,  +4.30e+05 ;
% b2,       0.0550 ,  +0.17994 ,  +0.00e+00 ,  -7.76e-01 ,  +1.48e-01 ,  -7.59e-01 ,  +3.59e+02 ,  -7.09e+03 ,  +4.59e+05 ;
% b2,       0.0100 ,  +0.03277 ,  +0.00e+00 ,  -7.76e-01 ,  +1.67e-01 ,  -8.58e-01 ,  +3.50e+02 ,  -7.32e+03 ,  +4.82e+05 ;
% b2,       0.0050 ,  +0.01634 ,  +0.00e+00 ,  -7.71e-01 ,  +1.56e-01 ,  -1.80e+00 ,  +3.44e+02 ,  -6.44e+03 ,  +4.83e+05 ;
% b2,       0.0050 ,  +0.01631 ,  +0.00e+00 ,  -7.65e-01 ,  +6.84e-02 ,  -2.08e+00 ,  +3.65e+02 ,  -5.66e+03 ,  +3.89e+05 ;
% b2,       0.0050 ,  +0.01628 ,  +0.00e+00 ,  -7.61e-01 ,  -7.30e-03 ,  -1.62e+00 ,  +3.76e+02 ,  -6.32e+03 ,  +3.92e+05 ;
% m_accep,  0,0,0,0,0,0,0,0,0;
% b2,       0.0050 ,  +0.01630 ,  +0.00e+00 ,  -7.64e-01 ,  +5.10e-02 ,  -2.01e+00 ,  +3.73e+02 ,  -5.84e+03 ,  +3.90e+05 ;
% b2,       0.0100 ,  +0.03270 ,  +0.00e+00 ,  -7.72e-01 ,  +1.63e-01 ,  -1.44e+00 ,  +3.52e+02 ,  -6.74e+03 ,  +4.55e+05 ;
% b2,       0.0100 ,  +0.03277 ,  +0.00e+00 ,  -7.76e-01 ,  +1.61e-01 ,  -5.35e-01 ,  +3.60e+02 ,  -7.41e+03 ,  +4.73e+05 ;
% b2,       0.1750 ,  +0.56934 ,  +0.00e+00 ,  -7.75e-01 ,  +1.80e-01 ,  +7.06e-01 ,  +3.65e+02 ,  -6.08e+03 ,  +4.35e+05 ;
% b2,       0.1750 ,  +0.56881 ,  +0.00e+00 ,  -7.75e-01 ,  +1.84e-01 ,  +1.58e+00 ,  +3.84e+02 ,  -5.75e+03 ,  +4.27e+05 ;
% b2,       0.0200 ,  +0.06327 ,  +0.00e+00 ,  -7.96e-01 ,  +2.40e-02 ,  +6.47e+00 ,  +3.92e+02 ,  -3.96e+03 ,  +3.36e+05 ;
% b2,       0.0100 ,  +0.02704 ,  +0.00e+00 ,  -6.73e-01 ,  -2.43e-01 ,  +1.29e+01 ,  +7.85e+01 ,  +6.80e+03 ,  +1.98e+05 ;
% b2_edge, 0,0,0,0,0,0,0,0,0;
% b2,       0.0150 ,  +0.02831 ,  +0.00e+00 ,  -3.48e-01 ,  -2.36e+00 ,  +1.83e+01 ,  -1.03e+02 ,  +1.34e+04 ,  -6.97e+04 ;
% b2,       0.0200 ,  +0.01996 ,  +0.00e+00 ,  -1.02e-01 ,  -2.16e+00 ,  +1.07e+01 ,  -1.02e+02 ,  +5.84e+03 ,  -3.09e+04 ;
% b2,       0.0300 ,  +0.01244 ,  +0.00e+00 ,  -2.21e-02 ,  -9.29e-01 ,  +3.84e+00 ,  +4.06e+00 ,  +3.46e+02 ,  +4.58e+03 ;
% b2,       0.0320 ,  +0.00487 ,  +0.00e+00 ,  -3.89e-03 ,  -2.80e-01 ,  +8.00e-01 ,  +1.18e+01 ,  -2.70e+01 ,  +8.66e+01 ;
% b2,       0.0325 ,  +0.00458 ,  -1.14e-04 ,  -7.17e-05 ,  -1.39e-01 ,  +1.99e-01 ,  +5.42e+00 ,  -1.25e+01 ,  -2.30e+02 ;
% m_accep,  0,0,0,0,0,0,0,0,0;
% ];






% turns deflection angle error off (convenient for having a nominal model with zero 4d closed orbit)
segmodel(:,4) = 0;

% builds half of the magnet model
d2r = pi/180.0;
b = zeros(1,size(segmodel,1));
maxorder = 1+max(monomials);
for i=1:size(segmodel,1)
    type = types{segmodel(i,1)};
    if strcmpi(type.passmethod, 'IdentityPass')
        b(i) = marker(type.fam_name, 'IdentityPass');
    else
        PolyB = zeros(1,maxorder); PolyA = zeros(1,maxorder);
        PolyB(monomials+1) = segmodel(i,4:end);
        PolyB(1) = 0.0; PolyA(1) = 0.0; % convenience of a nominal lattice with zero 4D closed-orbit.
        b(i) = rbend_sirius(type.fam_name, segmodel(i,2), d2r * segmodel(i,3), 0, 0, 0, 0, 0, PolyA, PolyB, passmethod);
    end
end

% builds entire magnet model, inserting additional markers
model_length = 2*sum(segmodel(:,2));
mb2 = marker(mb_famname, 'IdentityPass');
m_accep = marker(types{m_accep}.fam_name, 'IdentityPass');
model = [fliplr(b), mb2, m_accep, b];
